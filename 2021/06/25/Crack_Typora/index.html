<!DOCTYPE html><html lang="zh-CH" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Crack_Typora | The_Itach1</title><meta name="keywords" content="软件逆向"><meta name="author" content="The_Itach1"><meta name="copyright" content="The_Itach1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="Crack_Typora产生这篇文章的原因呢是因为之前在看雪看到了一篇破解文章，然后感觉有点意思，就自己也来试试，同样也是参考了很多资料和文章吧。 然后我主要也是分析了两个版本，一个是1.2.5，和最新的1.3.6吧，然后在总结文章的时候发现又发行了1.3.7版本。 支持正版，本文章只作为技术分享。 Typora简介具体就去官网搜就完事，就是一款很好用的文章编辑工具，现在很多文章实际上都采用了md">
<meta property="og:type" content="article">
<meta property="og:title" content="Crack_Typora">
<meta property="og:url" content="http://example.com/2021/06/25/Crack_Typora/index.html">
<meta property="og:site_name" content="The_Itach1">
<meta property="og:description" content="Crack_Typora产生这篇文章的原因呢是因为之前在看雪看到了一篇破解文章，然后感觉有点意思，就自己也来试试，同样也是参考了很多资料和文章吧。 然后我主要也是分析了两个版本，一个是1.2.5，和最新的1.3.6吧，然后在总结文章的时候发现又发行了1.3.7版本。 支持正版，本文章只作为技术分享。 Typora简介具体就去官网搜就完事，就是一款很好用的文章编辑工具，现在很多文章实际上都采用了md">
<meta property="og:locale" content="zh_CH">
<meta property="og:image" content="https://s2.loli.net/2022/06/28/dTDv5MHfmJS72or.jpg">
<meta property="article:published_time" content="2021-06-25T09:38:45.000Z">
<meta property="article:modified_time" content="2022-06-28T14:49:43.708Z">
<meta property="article:author" content="The_Itach1">
<meta property="article:tag" content="软件逆向">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/06/28/dTDv5MHfmJS72or.jpg"><link rel="shortcut icon" href="/img/2.png"><link rel="canonical" href="http://example.com/2021/06/25/Crack_Typora/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-28 22:49:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/5.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> music</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s2.loli.net/2022/06/28/dTDv5MHfmJS72or.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">The_Itach1</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> music</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">Crack_Typora</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-06-25T09:38:45.000Z" title="Created 2021-06-25 17:38:45">2021-06-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-28T14:49:43.708Z" title="Updated 2022-06-28 22:49:43">2022-06-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Reverse/">Reverse</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Crack-Typora"><a href="#Crack-Typora" class="headerlink" title="Crack_Typora"></a>Crack_Typora</h1><p>产生这篇文章的原因呢是因为之前在看雪看到了一篇破解文章，然后感觉有点意思，就自己也来试试，同样也是参考了很多资料和文章吧。</p>
<p>然后我主要也是分析了两个版本，一个是1.2.5，和最新的1.3.6吧，然后在总结文章的时候发现又发行了1.3.7版本。</p>
<p>支持正版，本文章只作为技术分享。</p>
<h2 id="Typora简介"><a href="#Typora简介" class="headerlink" title="Typora简介"></a>Typora简介</h2><p>具体就去官网搜就完事，就是一款很好用的文章编辑工具，现在很多文章实际上都采用了md格式，个人比较喜欢使用MarkdownPad因为MarkdownPad支持双界面，然后Typora需要切换，实际上都差不多的。</p>
<p>先来看看Typora的框架，Typora本质是js和Electron框架开发的，利用这个框架，可以做到windows桌面程序的效果，本质可以理解为就是个网站，而且如果我们打开Typora的开发者选项，实际上可以看到谷歌的浏览器引擎。</p>
<h2 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h2><p>这里主要是分析1.3.6相关的，其中会使用之前的版本来对比分析。</p>
<h3 id="切入点"><a href="#切入点" class="headerlink" title="切入点"></a>切入点</h3><p>我们已经知道是Electron框架开发了，先来看看网上对于这种逆向的一些相关文章。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cc11001100/p/14290584.html">https://www.cnblogs.com/cc11001100/p/14290584.html</a></p>
<p>所以我们知道了我们实际上需要分析的就是那个app.asar，然后跟着文章尝试去解包。</p>
<p>需要用到的工具asar，先安装工具。</p>
<pre><code>npm install --engine-strict asar</code></pre>
<p>然后解包</p>
<pre><code>asar e app.asar app</code></pre>
<p>我先是将文件单独脱出来，然后去解包，根据报错发现缺少了一个文件main.node。</p>
<p>然后发现实际上这个文件就在Typora的resources/app.asar.unpacked目录下，所以干脆在原地方解包，然后生成了三个文件。</p>
<ul>
<li>atom.js    经过加密的base64代码</li>
<li>main.node    一个pe文件，根据前面的分析和unpacked，猜测和解密有关</li>
<li>package.json    保存一些信息。</li>
</ul>
<p>到这里，我们已经知道的信息，js源码被加密，main.node可能是解密文件，所以想分析源码，我们需要知道atom.js如何被加密，以及如何解密。</p>
<h3 id="分析main-node"><a href="#分析main-node" class="headerlink" title="分析main.node"></a>分析main.node</h3><p>先使用ida打开，查看字符串。<br><img src="https://s2.loli.net/2022/06/26/HKvhrFaXDOIE2xs.png"><br>使用findcrypt插件可以看到一些AES加解密密的痕迹。<br><img src="https://s2.loli.net/2022/06/26/jNOCEVLwxAmaRUI.png" alt="Snipaste_2022-06-26_21-08-31.png"><br>我们这里对第三个数据进行交叉引用，因为是解密所以肯定用到的是inv。</p>
<p>动调分析，这里推荐一个插件ret-sync，<a target="_blank" rel="noopener" href="https://github.com/bootleg/ret-sync">https://github.com/bootleg/ret-sync</a>，可以使用x64dbg调试的同时还能在ida中看位置，这个软件实际上感觉使用ida动调的效果并不是很好，所以推荐使用x64dbg。</p>
<p>后分析发现流程如下。</p>
<p>调用一些napi函数，<a target="_blank" rel="noopener" href="http://nodejs.cn/api/n-api.html">http://nodejs.cn/api/n-api.html</a>，估计是在读取app.asar文件，然后返回获取的数据。<br><img src="https://s2.loli.net/2022/06/26/CpbxQzM4sdN5Aq3.png" alt="Snipaste_2022-06-26_21-21-36.png"><br>根据动调传入的参数判断，下面的一个函数就是解密数据的函数了。<br><img src="https://s2.loli.net/2022/06/26/1KygVhNqnz3ioXj.png" alt="Snipaste_2022-06-26_21-33-13.png"><br>推荐分析过程中多打硬件断点，可以方便分析函数功能，然后经过我的动调分析，这个函数内部的流程如下，我也给了足够的注释。</p>
<p>先base64解密，和申请内存空间之类的<br><img src="https://s2.loli.net/2022/06/26/2KLcJmaOIgw7ijl.png"><br>生成iv，扩展密钥，aes256-cbc模式解密。<br><img src="https://s2.loli.net/2022/06/26/RbLaA9j7vTOoB2P.png"><br>先进入aes函数看看，如何分析出的aes256-cbc的。<br><img src="https://s2.loli.net/2022/06/26/VnRJWyCAb6XHfDe.png"></p>
<p>退出出来，继续向下分析，后面就是确定js代码具体长度，和释放申请的空间。<br><img src="https://s2.loli.net/2022/06/26/wRFgj4UePNoGHOT.png"><br>最后就是调用napi_create_string_utf8了。<br><img src="https://s2.loli.net/2022/06/26/ihXDxeK36OkjtTC.png"></p>
<p>到这里实际上1.3.6版本的main.node就分析完了，后面我也去解包1.2.5版本的，发现1.2.5版本的实际上解密跟简单，先使用napi的函数解密base64，然后aes256-cbc，但是iv和key都是直接给，对比一下1.3.6的版本分析起来更加困难。</p>
<p>最后就是后面遇到的一个问题了，就是1.3.6版本仿佛对js代码的长度要求比较严格，这一点后面来说。</p>
<p>这时我们无论是通过自己写脚本解密，还是调试dump内存，都已经可以获取到js源码了。</p>
<p>贴一个python脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">enc=<span class="string">&#x27;aotm.js里面的base64编码&#x27;</span></span><br><span class="line"></span><br><span class="line">temp=base64.b64decode(enc)</span><br><span class="line"></span><br><span class="line">print(temp)</span><br><span class="line">temp=temp[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">key=<span class="string">b&#x27;\x78\x18\xb7\x7e\x5f\xb1\x4d\x40\x52\x11\x43\xe2\xac\x5a\x15\xc1\x7a\x48\x97\x00\x41\x43\x1f\xf7\x6e\x6e\xa7\xd5\x7c\x66\x94\xa1&#x27;</span></span><br><span class="line"></span><br><span class="line">iv=<span class="string">b&#x27;\x79\xd9\xa0\x9f\x39\xf9\xba\x2f\xe4\x25\xf7\x9a\x66\x21\xc5\x86&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line">msg = cipher.decrypt(temp)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="分析js代码"><a href="#分析js代码" class="headerlink" title="分析js代码"></a>分析js代码</h3><p>由于对js的了解不多，这也给我造成了一些困难，但是好在网上有部分资料可以参考。</p>
<p>可以使用vscode和插件beautiful，使js代码变好看，其注册代码主要是在445: 开始到结束的代码。</p>
<p>1.3.6和1.2.5版本的js代码差不多，然后都去掉了符号表信息，给分析添加了更多困难，但是还好网上存在1.0版本的js代码，是存在符号表信息的，这为分析提供了参考。</p>
<p>并且，粗略分析可以发现，其存在读写注册表和写日志的代码，所以可以根据注册表和日志来辅助分析。</p>
<p>列出关键的几个点吧</p>
<h4 id="e-startL"><a href="#e-startL" class="headerlink" title="e.startL"></a>e.startL</h4><p>起始点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;start LM in devVersion=&quot;</span> + (<span class="built_in">global</span>.devVersion || !<span class="number">1</span>));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ne(), <span class="keyword">await</span> U(), !e &amp;&amp; t || y || (<span class="built_in">global</span>.devVersion || !t || -<span class="number">1</span> &lt; t.indexOf(<span class="string">&quot;dev&quot;</span>) || <span class="built_in">global</span>.compareVersion(t, <span class="string">&quot;1.0.0&quot;</span>) &lt; <span class="number">0</span>) &amp;&amp; (<span class="built_in">console</span>.log(<span class="string">&quot;re-write InstallDate&quot;</span>), <span class="keyword">await</span> M()), r || y || <span class="built_in">global</span>.devVersion &amp;&amp; <span class="built_in">global</span>.PRODUCTION_MODE &amp;&amp; (n = J(), o = <span class="keyword">new</span> <span class="built_in">Date</span>, i = <span class="number">1654861367114</span>, <span class="built_in">console</span>.log(<span class="string">&quot;buildTime is &quot;</span> + i), (<span class="built_in">isNaN</span>(i) || o - i &gt; <span class="number">240</span> * I) &amp;&amp; Q(), n = +n, <span class="built_in">console</span>.log(<span class="string">&quot;verInitTime is &quot;</span> + n), !<span class="built_in">isNaN</span>(n) &amp;&amp; o - n &gt; <span class="number">200</span> * I &amp;&amp; Q()), (<span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&quot;[watch L]&quot;</span>), q(e), <span class="keyword">await</span> H(), <span class="built_in">console</span>.log(<span class="string">&quot;[watch L] hasL: &quot;</span> + r), Z(), A()</span><br><span class="line">                    &#125;)(e)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    s.captureException(e)</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p>这里我们可以去日志那里去看看，其中的”[watch L] hasL: “ r，这个r实际上就是代表了是否注册。</p>
<p>具体位置在user/名称/AppData/Roaming/Typora/Typora.log。</p>
<h4 id="ne"><a href="#ne" class="headerlink" title="ne()"></a>ne()</h4><p>验证证书的一个函数。</p>
<p>流程如下‘</p>
<ul>
<li>先匹配邮箱的格式是否正确</li>
<li>然ee()匹配输入的序列号格式是否正确。</li>
<li>然后通过注册表获取了计算机的一些信息，MachineGuid，计算机名称，操作系统等。</li>
<li>N(“api/client/activate”, t, !0);，想网站发送信息验证。</li>
<li>查看返回的值是否为P.SUCCESS，进入X(o.msg)</li>
</ul>
<h4 id="U"><a href="#U" class="headerlink" title="U()"></a>U()</h4><p>获取计算机唯一标识符MachineGuid，返回给全局变量a</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> U = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (!a) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (w) &#123;</span><br><span class="line">                        <span class="keyword">const</span> t = F(<span class="string">&quot;native-reg&quot;</span>);</span><br><span class="line">                        <span class="keyword">var</span> e = t.openKey(t.HKEY.LOCAL_MACHINE, <span class="string">&quot;SOFTWARE\\Microsoft\\Cryptography&quot;</span>, t.Access.WOW64_64KEY | t.Access.READ);</span><br><span class="line">                        a = t.getValue(e, <span class="literal">null</span>, <span class="string">&quot;MachineGuid&quot;</span>), t.closeKey(e)</span><br><span class="line">                    &#125; <span class="keyword">else</span> a = <span class="keyword">await</span> i(<span class="number">560</span>).machineId(&#123;</span><br><span class="line">                        original: !<span class="number">0</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    a || s.captureMessage(<span class="string">&quot;[L] Failed to get fingerPrint&quot;</span>), a = _(a, <span class="string">&quot;typora&quot;</span>).substr(<span class="number">0</span>, <span class="number">10</span>).replace(<span class="regexp">/[/=+-]/g</span>, <span class="string">&quot;a&quot;</span>), b &amp;&amp; (a += <span class="string">&quot;darwin&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="时间和版本相关的计算"><a href="#时间和版本相关的计算" class="headerlink" title="时间和版本相关的计算####"></a>时间和版本相关的计算####</h4><p>先是判断版本。</p>
<pre><code>global.compareVersion(t, &quot;1.0.0&quot;) &lt; 0</code></pre>
<p>然后和时间相关的判断</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">J = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">var</span> t = <span class="keyword">new</span> <span class="built_in">Date</span>(d().get(<span class="string">&quot;IDate&quot;</span>));</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">isNaN</span>(t.getTime()) ? e ? <span class="literal">null</span> : <span class="keyword">new</span> <span class="built_in">Date</span> : e ? t : (e = <span class="number">1654861367114</span>, <span class="built_in">isNaN</span>(e) ? e = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;2021-10-01&quot;</span>) : (e = <span class="keyword">new</span> <span class="built_in">Date</span>(e), <span class="built_in">isNaN</span>(e.getTime()) &amp;&amp; (e = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;2021-10-01&quot;</span>))), t &lt; e ? e : t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(n = J(), </span><br><span class="line">o = <span class="keyword">new</span> <span class="built_in">Date</span>, </span><br><span class="line">i = <span class="number">1654861367114</span>, </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;buildTime is &quot;</span> + i), </span><br><span class="line">(<span class="built_in">isNaN</span>(i) || o - i &gt; <span class="number">240</span> * I) &amp;&amp; Q(), </span><br><span class="line">n = +n, </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;verInitTime is &quot;</span> + n), </span><br><span class="line">!<span class="built_in">isNaN</span>(n) &amp;&amp; o - n &gt; <span class="number">200</span> * I &amp;&amp; Q())</span><br></pre></td></tr></table></figure>

<ul>
<li>1654861367114实际上是一个时间戳转10进制的值，是本版本Typora的发行日期，也就是Typora.exe后面跟的那个日期。</li>
<li>J()是一个返回Typora安装时写入注册表中的日期，注册表位置为HKEY_USERS\S-1-5-21-4000056630-3765125010-2384809673-1001\SOFTWARE\Typora，这里保留着证书和安装日期。</li>
<li>然后就是I=864e5 I*240实际上差不多就是15天的样子。</li>
</ul>
<h4 id="H"><a href="#H" class="headerlink" title="H()"></a>H()</h4><p>这也是时间判断的相关函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">J = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t = <span class="keyword">new</span> <span class="built_in">Date</span>(d().get(<span class="string">&quot;IDate&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isNaN</span>(t.getTime()) ? e ? <span class="literal">null</span> : <span class="keyword">new</span> <span class="built_in">Date</span> : e ? t : (e = <span class="number">1654861367114</span>, <span class="built_in">isNaN</span>(e) ? e = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;2021-10-01&quot;</span>) : (e = <span class="keyword">new</span> <span class="built_in">Date</span>(e), <span class="built_in">isNaN</span>(e.getTime()) &amp;&amp; (e = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;2021-10-01&quot;</span>))), t &lt; e ? e : t)</span><br><span class="line">&#125;, V = <span class="function">(<span class="params">e, t</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (t = t || <span class="number">15</span>, <span class="number">432e5</span> &lt; u - <span class="keyword">new</span> <span class="built_in">Date</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="built_in">Math</span>.floor((<span class="keyword">new</span> <span class="built_in">Date</span> - u) / <span class="number">864e5</span>),</span><br><span class="line">        n = <span class="built_in">Math</span>.max(<span class="number">0</span>, t - n);</span><br><span class="line">    <span class="keyword">return</span> n = e &amp;&amp; (t &lt; n || <span class="built_in">isNaN</span>(n)) ? t : n</span><br><span class="line">&#125;, H = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> e = (u = J(!<span class="built_in">global</span>.devVersion)) ? V(!<span class="number">1</span>) : <span class="number">100</span>;</span><br><span class="line">    (<span class="number">15</span> &lt; e || <span class="built_in">isNaN</span>(e)) &amp;&amp; (<span class="built_in">console</span>.log(<span class="string">&quot;[L] Read from incorrupted InstallDate&quot;</span>), <span class="keyword">await</span> M(!<span class="number">0</span>), e = <span class="number">15</span>), <span class="built_in">console</span>.log(<span class="string">`[L] installDate is <span class="subst">$&#123;u.toLocaleDateString(<span class="string">&quot;en-US&quot;</span>)&#125;</span>, trail remains: <span class="subst">$&#123;e&#125;</span> days`</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>计算还剩多少试用天数，然后记录到日志。</p>
<h4 id="q-e"><a href="#q-e" class="headerlink" title="q(e)"></a>q(e)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">	le = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	    f.getAllWindows().forEach(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">	        e.webContents.executeJavaScript(<span class="string">`try&#123;document.querySelector(&quot;.<span class="subst">$&#123;ae&#125;</span>&quot;).remove();&#125;catch(e)&#123;&#125;;File.option &amp;&amp; (File.option.hasLicense = true);File.megaMenu &amp;&amp; File.megaMenu.forceReload();0;`</span>)</span><br><span class="line">	    &#125;)</span><br><span class="line">	&#125;,</span><br><span class="line">	se = <span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">	    <span class="keyword">await</span> p.initDict();</span><br><span class="line">	    <span class="keyword">const</span> t = <span class="string">`.typora-sourceview-on .<span class="subst">$&#123;ae&#125;</span>&#123;left: 170px;&#125;.<span class="subst">$&#123;ae&#125;</span> &#123;position: fixed;bottom: 2px;z-index: 9999;left: 70px;font-size: 12px;line-height: 24px;background: rgb(120 120 120 / 30%);padding: 0 12px;color: var(--text-color);border-radius: 4px;cursor: pointer;&#125;.pin-outline .<span class="subst">$&#123;ae&#125;</span>&#123;left:calc(var(--sidebar-width) + 70px);&#125;`</span>,</span><br><span class="line">	        n = <span class="string">`if(window.File.option)&#123;File.option.hasLicense = false;File.megaMenu &amp;&amp; File.megaMenu.forceReload();if(!document.querySelector(&quot;.<span class="subst">$&#123;ae&#125;</span>&quot;)) &#123;const pos = Math.round(Math.random() * document.body.children.length);const dom = document.createElement(&quot;DIV&quot;);dom.innerText = &quot;<span class="subst">$&#123;p.getPanelString(<span class="string">&quot;UNREGISTERED&quot;</span>)&#125;</span> ×&quot;;dom.classList.add(&quot;<span class="subst">$&#123;ae&#125;</span>&quot;);dom.style = &quot;position: fixed !important;bottom: 2px !important; display: block !important; opacity: 1 !important; height: auto !important; width: auto !important; z-index: 9999 !important;&quot;;dom.setAttribute(&quot;role&quot;, &quot;button&quot;);dom.addEventListener(&quot;click&quot;, () =&gt; &#123;dom.remove();reqnode(&quot;electron&quot;).ipcRenderer.invoke(&quot;license.show&quot;);&#125;);document.body.insertBefore(dom, document.body.children[pos]);&#125;&#125;;1;`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        e.webContents.insertCSS(t.replace(<span class="regexp">/(\&#123;|\&#125;|;)\n/g</span>, <span class="string">&quot;$1&quot;</span>)), e.webContents.executeJavaScript(n.replace(<span class="regexp">/(\&#123;|\&#125;|;)\n/g</span>, <span class="string">&quot;$1&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    e ? o(e) : f.getAllWindows().forEach(o)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    O = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> e = d().get(<span class="string">&quot;SLicense&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!e) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> [t, n, o] = e.split(<span class="string">&quot;#&quot;</span>), t = E(t);</span><br><span class="line">        <span class="keyword">return</span> t &amp;&amp; t.fingerprint == a ? (<span class="built_in">Object</span>.assign(t, &#123;</span><br><span class="line">            failCounts: n,</span><br><span class="line">            lastRetry: <span class="keyword">new</span> <span class="built_in">Date</span>(o)</span><br><span class="line">        &#125;), t) : <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">j</span>(<span class="params">e, t, n</span>) </span>&#123;</span><br><span class="line">        c = t, D = n, (r = !(!(x = e) || !c)) &amp;&amp; le()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        r || (e = <span class="string">&quot;&quot;</span>), c = x = <span class="string">&quot;&quot;</span>, r = !<span class="number">1</span>, d().put(<span class="string">&quot;SLicense&quot;</span>, <span class="string">&quot;&quot;</span>), e &amp;&amp; K(p.getPanelString(<span class="string">&quot;Typora is now deactivated&quot;</span>), p.getPanelString(e)), se()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> q = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        R = !<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> t = O(),</span><br><span class="line">            &#123;</span><br><span class="line">                license: n,</span><br><span class="line">                email: o,</span><br><span class="line">                type: i</span><br><span class="line">            &#125; = t || &#123;&#125;;</span><br><span class="line">        n &amp;&amp; o ? (j(o, n, i), z(t, e)) : $()</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>O()，这个函数会从注册表HKEY_USERS\S-1-5-21-4000056630-3765125010-2384809673-1001\SOFTWARE\Typora取出SLicense项的值，然后处理，分成邮箱，注册码，等信息。</li>
<li>$()，这个函数代表失败，最终会执行se()</li>
<li>j(o, n, i)函数可以走向成功函数le()，但是需要r=true</li>
<li>z(t, e)，这个函数为网络验证</li>
</ul>
<h2 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h2><h3 id="破解思路"><a href="#破解思路" class="headerlink" title="破解思路"></a>破解思路</h3><p>想破解，肯定还是得从js代码入手。</p>
<h4 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h4><p>我们知道试用天数为15天，而其天数实际上从注册表中的idate读取的，所以第一个思路就是去修改注册表中的安装时间，或者去修改判断时间逻辑，但是需要更加熟悉相关部分的js代码。</p>
<h4 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h4><p>可以看到，其最终要求实际上就是需要r=true，我们只需要让在进入关键判定前使r=true即可。</p>
<h3 id="具体实施"><a href="#具体实施" class="headerlink" title="具体实施"></a>具体实施</h3><p>这里也是有两个方法，一个基于文件，一个基于内存。</p>
<h4 id="基于文件"><a href="#基于文件" class="headerlink" title="基于文件"></a>基于文件</h4><p>基于文件实际上很简单，将修改后的js代码，然后以相同的方式加密回去，然后重新生成atom.js。然后用asar打包回去。</p>
<pre><code>asar p . ./app.asar</code></pre>
<p>然后是会出问题的，对于1.3.6版本这样是不行的，1.2.5是可以这样，然后我分析了原因，发现了这一版本对js代码长度要求比较高，因为1.3.6版本的mian.node实际上解base64是是使用的c代码，并没有使用1.2.5版本使用的napi的函数，所以对于长度的要求就就变严格了，相当于做了个长度的文件效验吧。</p>
<p>上面实际上也是我测试出来的，因为我在最后的napi_create_string_utf8，修改了了内存，发现修改后的js是可以运行起的，并且能够破解，所以后面是没有其他的判定的。</p>
<p>给出python代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key=<span class="string">b&#x27;\x78\x18\xb7\x7e\x5f\xb1\x4d\x40\x52\x11\x43\xe2\xac\x5a\x15\xc1\x7a\x48\x97\x00\x41\x43\x1f\xf7\x6e\x6e\xa7\xd5\x7c\x66\x94\xa1&#x27;</span></span><br><span class="line"></span><br><span class="line">iv=<span class="string">b&#x27;\x79\xd9\xa0\x9f\x39\xf9\xba\x2f\xe4\x25\xf7\x9a\x66\x21\xc5\x86&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line">msg=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">len</span>(msg)))</span><br><span class="line"></span><br><span class="line">enc = cipher.encrypt(msg)</span><br><span class="line">enc+=<span class="string">b&#x27;\xcb&#x27;</span>  <span class="comment">#这是解密最后删除的一字节</span></span><br><span class="line"><span class="comment">#print(enc)</span></span><br><span class="line">print(base64.b64encode(enc).decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="基于内存"><a href="#基于内存" class="headerlink" title="基于内存"></a>基于内存</h4><p>当文件不可用了怎么办，或者有文件效验，就可以采用修改内存的方法了。</p>
<p>可以先基于调试器在napi_create_string_utf8函数打断点，然后修改js代码，和长度，如下。</p>
<p>说明可行，但是每次不可能都采用调试的方式修改，所以可以采取hook这个napi_create_string_utf8函数的方法，判断下传入的参数，如果是解密后的js，我们就跳到我们的shellcode，然后修改，然后在调用<br>napi_create_string_utf8。<br><img src="https://s2.loli.net/2022/06/27/AIz8ZmXVU6pCFY1.png"></p>
<p>存在问题及解决方法。</p>
<ul>
<li>main.node是后加载的dll，并且只加载一次，所以我们要先于加载main.node前，去安装好我们的hook代码。解决方法就是直接去创建这个进程，挂起状态，然后修改iat。或者是直接修改文件。</li>
<li>64位的hook和32位略有不同，调试，然后注意地址是8byte这些。</li>
<li>shellcode的编写问题，考验汇编，或者先用C语言，然后提取，但是不能有全局变量，函数也得自己获取。</li>
</ul>
<p>这里就不在花时间去弄了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>整个过程比较复杂，但是js代码还是能够轻松获取，就算不知道解密算法，也能够调试获取，所以可以考虑添加一些反调试手段。</p>
<p>最后就是js代码的分析问题了，虽然已经去掉了函数名称和变量名称，但是仍可以猜出大概逻辑。</p>
<p>建议添加一些关于文件效验的代码，来检测是否被修改，但是也只是能起到很少的效果。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">The_Itach1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/06/25/Crack_Typora/">http://example.com/2021/06/25/Crack_Typora/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%BD%AF%E4%BB%B6%E9%80%86%E5%90%91/">软件逆向</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/06/28/dTDv5MHfmJS72or.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/11/%E5%A4%A7%E4%B8%80%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5%E4%BD%9C%E4%B8%9A/"><img class="prev-cover" src="https://i.loli.net/2021/07/11/U7WiwgDa81JvbOj.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">工程实践作业报告</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/05/2021.6.1%E8%90%8C%E6%96%B0%E8%B5%9B%20re%20wp/"><img class="next-cover" src="https://i.loli.net/2021/06/05/THf3oiypBSDq6bx.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2021.6.1萌新赛 re wp</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/12/02/Simple software cracking/" title="Simple software cracking"><img class="cover" src="https://i.loli.net/2021/12/02/gaPGbVDE1NFzupY.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-02</div><div class="title">Simple software cracking</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/5.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">The_Itach1</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Crack-Typora"><span class="toc-number">1.</span> <span class="toc-text">Crack_Typora</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Typora%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">Typora简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">分析过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">切入点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90main-node"><span class="toc-number">1.2.2.</span> <span class="toc-text">分析main.node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90js%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.3.</span> <span class="toc-text">分析js代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#e-startL"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">e.startL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ne"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">ne()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#U"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">U()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E7%89%88%E6%9C%AC%E7%9B%B8%E5%85%B3%E7%9A%84%E8%AE%A1%E7%AE%97"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">时间和版本相关的计算####</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#H"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">H()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#q-e"><span class="toc-number">1.2.3.6.</span> <span class="toc-text">q(e)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3%E6%80%9D%E8%B7%AF"><span class="toc-number">1.3.1.</span> <span class="toc-text">破解思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E4%B8%80"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">思路一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E4%BA%8C"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">思路二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E6%96%BD"><span class="toc-number">1.3.2.</span> <span class="toc-text">具体实施</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">基于文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">基于内存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/11/Recent%20CTF%20summary/" title="Recent CTF summary"><img src="https://s2.loli.net/2022/06/10/HR1Wcv8IJAznUOd.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Recent CTF summary"/></a><div class="content"><a class="title" href="/2022/06/11/Recent%20CTF%20summary/" title="Recent CTF summary">Recent CTF summary</a><time datetime="2022-06-11T09:38:45.000Z" title="Created 2022-06-11 17:38:45">2022-06-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/30/Simple%20Exe%20Packing/" title="Simple Exe Packing"><img src="https://s2.loli.net/2022/03/30/cVsNfuSDZGqMO4r.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Simple Exe Packing"/></a><div class="content"><a class="title" href="/2022/03/30/Simple%20Exe%20Packing/" title="Simple Exe Packing">Simple Exe Packing</a><time datetime="2022-03-30T10:38:45.000Z" title="Created 2022-03-30 18:38:45">2022-03-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/15/OWASP%20Top%2010%20learning/" title="OWASP Top 10 learning"><img src="https://s2.loli.net/2022/03/15/Afs4qw2QXxeUHlO.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OWASP Top 10 learning"/></a><div class="content"><a class="title" href="/2022/03/15/OWASP%20Top%2010%20learning/" title="OWASP Top 10 learning">OWASP Top 10 learning</a><time datetime="2022-03-15T10:38:45.000Z" title="Created 2022-03-15 18:38:45">2022-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/25/%E5%90%91%E6%97%A5%E8%91%B5%20CNVD-2022-10270%E5%88%86%E6%9E%90/" title="向日葵 CNVD-2022-10270分析"><img src="https://s2.loli.net/2022/02/25/v2oYBbMdSCqf3gc.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="向日葵 CNVD-2022-10270分析"/></a><div class="content"><a class="title" href="/2022/02/25/%E5%90%91%E6%97%A5%E8%91%B5%20CNVD-2022-10270%E5%88%86%E6%9E%90/" title="向日葵 CNVD-2022-10270分析">向日葵 CNVD-2022-10270分析</a><time datetime="2022-02-25T10:38:45.000Z" title="Created 2022-02-25 18:38:45">2022-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/25/hgame%202022%20Re/" title="hgame 2022 re wp"><img src="https://s2.loli.net/2022/02/25/TD8lZVdK6XLFOuG.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hgame 2022 re wp"/></a><div class="content"><a class="title" href="/2022/02/25/hgame%202022%20Re/" title="hgame 2022 re wp">hgame 2022 re wp</a><time datetime="2022-02-25T09:38:45.000Z" title="Created 2022-02-25 17:38:45">2022-02-25</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://s2.loli.net/2022/06/28/dTDv5MHfmJS72or.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By The_Itach1</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">木叶飞舞之处，火亦生生不息</div><div class="icp"><a><span></span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>